# スキルUI大改修 設計書

## 概要
スキル画面のUI/UXを大幅に改善し、スキル装備とスキル強化を分離した専用画面を用意する。

---

## 1. タイル上のスキル表示
### 現状の問題
- スキルアイコンがタイル全体をオーバーレイしており、タイルの数字が見づらい

### 変更内容
- **バッジ式に戻す**: タイル右上に小さなスキルアイコンバッジを表示
- タイル本体の視認性を確保

---

## 2. CPUスキルセット
### 現状
- CPUが全スキルからランダムに使用

### 変更内容
- ステージごとに固定のスキルセットを事前定義
- 例:
  - Stage 1 (EASY): コスト低めのスキル3個
  - Stage 5 (HARD): バランス型スキル5個
  - Stage 10 (WORLD END): 高コストスキル含む最強構成

---

## 3. スキル画面（メイン）

### レイアウト
```
┌─────────────────────────────────────┐
│  ┌───────────┐  ┌───────────┐      │  ← 固定ヘッダー
│  │スキル装備 │  │スキル強化 │      │
│  └───────────┘  └───────────┘      │
├─────────────────────────────────────┤
│                                     │
│  ┌─────┐ ┌─────┐ ┌─────┐          │  ← スクロール領域
│  │スキル│ │スキル│ │スキル│  ...    │
│  │ ★★ │ │ ★  │ │     │          │  ← 強化レベル別に分離表示
│  └─────┘ └─────┘ └─────┘          │
│                                     │
│  ┌─────┐ ┌─────┐ ┌─────┐          │
│  │未所持│ │未所持│ │未所持│  ...    │  ← 常に最下部（グレー）
│  └─────┘ └─────┘ └─────┘          │
│                                     │
└─────────────────────────────────────┘
```

### 仕様
- **上部ボタン**: 画面固定（スクロールしない）
- **スキル一覧**: スクロール可能
- **表示順序**: 
  1. 所持スキル（ソート適用）
  2. 未所持スキル（常に最下部、ソート適用）
- **強化レベル別表示**: 
  - 同じスキルでも強化レベルが違えば別カードで表示
  - 例: リザレクション★2(1個)、リザレクション★1(2個)、リザレクション★0(3個)
- **星レベル表示**: ピンク色の★、背景なし
- **スキルタップ**: スキル詳細ポップアップ（閲覧のみ、強化機能なし）

---

## 4. スキル装備画面（プリセット選択）

### 遷移
スキル画面 → [スキル装備]ボタン → プリセット選択画面

### レイアウト
```
┌─────────────────────────────────────┐
│  [←戻る]        スキル装備          │  ← 固定ヘッダー
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │  プリセット1   コスト: 20    │   │
│  │  [スキル][スキル][スキル]... │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  プリセット2   コスト: 19    │   │
│  │  [スキル][スキル][+][+][+]   │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  プリセット3   (空)          │   │
│  │  [+][+][+][+][+]             │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  プリセット4   (空)          │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  プリセット5   (空)          │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

### 仕様
- **縦1列に5個表示**
- 各プリセットには現在のコストと装備スキルアイコンを表示
- **スキルアイコンには星レベルも表示**
- プリセットタップ → プリセット編集画面へ遷移
- [←戻る] → スキル画面へ戻る

---

## 5. スキル装備画面（プリセット編集）

### 遷移
プリセット選択画面 → プリセットタップ → プリセット編集画面

### レイアウト
```
┌─────────────────────────────────────┐
│  [←戻る]     コスト: 15/20         │  ← 固定ヘッダー
│                                     │
│  [スキル★2][スキル★1][+][+][+]     │  ← 選択中プリセット
│                                     │
│  [保存]                             │
├─────────────────────────────────────┤
│                                     │
│  ┌─────┐ ┌─────┐ ┌─────┐          │  ← スクロール領域
│  │スキル│ │スキル│ │スキル│  ...    │
│  │ ★★ │ │ ★  │ │     │          │
│  └─────┘ └─────┘ └─────┘          │
│                                     │
│  ┌─────┐ ┌─────┐                   │  ← コストオーバーは暗転
│  │暗転 │ │暗転 │                   │
│  └─────┘ └─────┘                   │
│                                     │
└─────────────────────────────────────┘
```

### 仕様
- **上部固定**: 戻るボタン、コスト表示、プリセット枠、保存ボタン
- **スキル一覧のみスクロール**
- **コストオーバー暗転**: この画面でのみ、残りコストを超えるスキルを暗転表示
- **スキルタップ**: プリセット枠に追加（既に装備済みなら外す）
- **プリセット枠のスキルタップ**: 外す
- **[+]タップ**: 何もしない（装備可能なスキルをタップして追加）
- **[保存]**: プリセット保存 → プリセット選択画面へ戻る
- **[←戻る]**: 保存せずプリセット選択画面へ戻る
- **コスト制約**: 19または20で保存可能

---

## 6. スキル強化画面

### 遷移
スキル画面 → [スキル強化]ボタン → スキル強化画面

### レイアウト
```
┌─────────────────────────────────────┐
│  [←戻る]        スキル強化          │  ← 固定ヘッダー
├─────────────────────────────────────┤
│                                     │
│  ┌─────────┐    ┌─────────┐        │
│  │         │    │         │        │
│  │ 選択    │ →  │ 強化後  │        │  ← 大きく表示
│  │ スキル  │    │ スキル  │        │
│  │  ★★   │    │  ★★★  │        │
│  └─────────┘    └─────────┘        │
│                                     │
│      [素材1] [素材2] [素材3]        │  ← 小さく横一列・中央揃え
│                                     │
│          [強化する]                 │  ← 素材不足時グレーアウト
│                                     │
├─────────────────────────────────────┤
│                                     │
│  ┌─────┐ ┌─────┐ ┌─────┐          │  ← スクロール領域
│  │スキル│ │スキル│ │スキル│  ...    │
│  │ ★★ │ │ ★  │ │     │          │
│  └─────┘ └─────┘ └─────┘          │
│                                     │
└─────────────────────────────────────┘
```

### 仕様
- **上部固定**: 戻るボタン、選択スキル、強化後スキル、素材欄、強化ボタン
- **所持スキル一覧のみスクロール**
- **強化レベル別表示**: 同じスキルでもレベル違いは別カード

### 強化フロー
1. 所持スキル一覧から「強化するスキル」をタップ → 左上の「選択スキル」枠にセット
2. 強化に必要な素材が表示される（スキルの現在レベルに応じて変動）
3. 所持スキル一覧から素材をタップ → 素材欄が埋まる
4. 全ての素材が揃ったら「強化する」ボタンが有効化
5. 「強化する」タップ → 強化完了、スキル一覧を更新

### 強化素材要件（参考）
| 現在レベル | 必要素材 |
|-----------|----------|
| ★0→★1 | 同スキル×1 |
| ★1→★2 | 同スキル×2 |
| ★2→★3 | 同スキル×2 + 同レア×2 |
| ★3→★4 | 同スキル×3 + 同レア×2 |
| ★4→★5 | 同スキル×3 + 同レア★3以上×2 |

---

## 7. 星レベル表示仕様

### 表示箇所
- スキル画面のスキル一覧
- プリセット選択画面のスキルアイコン
- プリセット編集画面のプリセット枠・スキル一覧
- スキル強化画面の全箇所
- **バトル画面のスキルアセットバー**

### スタイル
- 色: **ピンク**
- 背景: **なし**
- 表示: ★の数だけ表示（例: ★★★）
- 位置: スキルカード下部または右下

---

## 8. 画面遷移図

```
┌──────────┐
│ スキル画面 │
│ (メイン)  │
└────┬─────┘
     │
     ├──[スキル装備]──→ ┌─────────────┐
     │                  │プリセット選択│
     │                  └──────┬──────┘
     │                         │
     │                    [プリセット]
     │                         │
     │                         ▼
     │                  ┌─────────────┐
     │                  │プリセット編集│
     │                  │ [保存/戻る] │
     │                  └─────────────┘
     │
     └──[スキル強化]──→ ┌─────────────┐
                        │ スキル強化  │
                        │  [戻る]     │
                        └─────────────┘
```

---

## 9. 実装優先度

1. **高**: タイルスキル表示をバッジ式に戻す
2. **高**: スキル一覧の所持/未所持分離（常に未所持が下）
3. **高**: 星レベル表示修正（ピンク、背景なし）
4. **高**: 「未所持」バグ修正
5. **中**: スキル画面UI分割（装備/強化ボタン）
6. **中**: プリセット選択/編集画面
7. **中**: スキル強化画面
8. **中**: CPUステージ別スキルセット
9. **低**: バトル画面スキルアセットに星レベル追加

---

## 10. スキル詳細ポップアップ

### 変更内容
- **装備ボタン**: 削除（装備はプリセット編集画面で行う）
- **強化ボタン**: 残す
- **強化ボタン押下時**: スキル強化画面に遷移し、そのスキルを「強化元」として自動セット
- **強化レベル効果一覧**: 縦一列に表示、未到達はグレーアウト

### レイアウト
```
┌─────────────────────────────────────┐
│  [×閉じる]                          │
├─────────────────────────────────────┤
│  ┌─────────┐                        │
│  │ スキル  │  スキル名              │
│  │ アイコン│  ★★★★★ 攻撃 コスト:5  │
│  │   ★★  │  強化レベル: ★★☆☆☆    │
│  └─────────┘                        │
│                                     │
│  効果説明テキスト                    │
│                                     │
│  ─── 強化効果 ───                   │
│  ★1: コスト-1          ← 通常色     │
│  ★2: コスト-1          ← 通常色     │
│  ★3: コスト-1          ← グレー     │
│  ★4: コスト-1          ← グレー     │
│  ★5: コスト-1          ← グレー     │
│                                     │
│        [強化する]                   │  ← 押すとスキル強化画面へ
│                                     │
└─────────────────────────────────────┘
```

### 強化効果表示仕様
- 縦一列に★1〜★5の効果を表示
- **到達済みレベル**: 通常の文字色
- **未到達レベル**: グレーアウト（薄い色）
- **暫定効果**: 全スキル全レベル「コスト-1」（後で個別設計）

---

## 11. 注意事項

- 各画面の上部は**スクロール固定**
- 強化レベル別にスキルカードを分離表示
- 同じスキルの複数所持は個数表示ではなく**別カード**で表示

